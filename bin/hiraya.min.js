(function(t,e,i){function n(i,r){if(!e[i]){if(!t[i]){var a="function"==typeof require&&require;if(!r&&a)return a(i,!0);if(s)return s(i,!0);throw Error("Cannot find module '"+i+"'")}var o=e[i]={exports:{}};t[i][0].call(o.exports,function(e){var s=t[i][1][e];return n(s?s:e)},o,o.exports)}return e[i].exports}for(var s="function"==typeof require&&require,r=0;i.length>r;r++)n(i[r]);return n})({1:[function(t,e){var i={Class:t("./hiraya-core/class"),Emitter:t("./hiraya-core/emitter"),Collection:t("./hiraya-core/collection"),Stat:t("./hiraya-game/stat"),Stats:t("./hiraya-game/stats"),EntityTurnBased:t("./hiraya-game/entity-turnbased"),Entity:t("./hiraya-game/entity"),Game:t("./hiraya-game/game"),Tile:t("./hiraya-game/tile"),Tiles:t("./hiraya-game/tiles"),Level:t("./hiraya-game/level"),LevelTurnBased:t("./hiraya-game/level-turnbased")};"object"==typeof window&&(window.Hiraya=i),e.exports=i},{"./hiraya-core/class":2,"./hiraya-core/emitter":3,"./hiraya-core/collection":4,"./hiraya-game/stat":5,"./hiraya-game/stats":6,"./hiraya-game/entity-turnbased":7,"./hiraya-game/entity":8,"./hiraya-game/game":9,"./hiraya-game/tile":10,"./hiraya-game/tiles":11,"./hiraya-game/level":12,"./hiraya-game/level-turnbased":13}],2:[function(t,e){function i(t,e,i){return function(){return this.parent=t[e],i.apply(this,arguments)}}function n(t){var e=!1;for(var i in t.prototype)e=!0;return e}function s(t,e){function a(){r&&this.init&&this.init.apply&&this.init.apply(this,arguments)}var o=t.prototype;r=!1;var h=new t;r=!0;var u;for(var l in e)e.hasOwnProperty(l)&&(u=e[l],h[l]="function"!=typeof o[l]||"function"!=typeof u||n(u)?u:i(o,l,u));return a.prototype=h,a.prototype.constructor=a,a.extend=function(){for(var t=Array.prototype.slice.apply(arguments,arguments,0),e={},i=0;t.length>i;i++){var n=t[i];for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}return s(a,e)},a.create=function(t){var e;return"object"==typeof t?(e=a.extend(t),new e):new a},a}var r=!0,a=s(function(){},{});e.exports=a},{}],14:[function(t,e){var i=e.exports={};i.nextTick=function(){var t="undefined"!=typeof window&&window.setImmediate,e="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(t)return function(t){return window.setImmediate(t)};if(e){var i=[];return window.addEventListener("message",function(t){if(t.source===window&&"process-tick"===t.data&&(t.stopPropagation(),i.length>0)){var e=i.shift();e()}},!0),function(t){i.push(t),window.postMessage("process-tick","*")}}return function(t){setTimeout(t,0)}}(),i.title="browser",i.browser=!0,i.env={},i.argv=[],i.binding=function(){throw Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(){throw Error("process.chdir is not supported")}},{}],15:[function(t,e,i){(function(t){function e(t,e){if(t.indexOf)return t.indexOf(e);for(var i=0;t.length>i;i++)if(e===t[i])return i;return-1}t.EventEmitter||(t.EventEmitter=function(){});var n=i.EventEmitter=t.EventEmitter,s="function"==typeof Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},r=10;n.prototype.setMaxListeners=function(t){this._events||(this._events={}),this._events.maxListeners=t},n.prototype.emit=function(t){if("error"===t&&(!this._events||!this._events.error||s(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var e=this._events[t];if(!e)return!1;if("function"==typeof e){switch(arguments.length){case 1:e.call(this);break;case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:var i=Array.prototype.slice.call(arguments,1);e.apply(this,i)}return!0}if(s(e)){for(var i=Array.prototype.slice.call(arguments,1),n=e.slice(),r=0,a=n.length;a>r;r++)n[r].apply(this,i);return!0}return!1},n.prototype.addListener=function(t,e){if("function"!=typeof e)throw Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",t,e),this._events[t])if(s(this._events[t])){if(!this._events[t].warned){var i;i=void 0!==this._events.maxListeners?this._events.maxListeners:r,i&&i>0&&this._events[t].length>i&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),console.trace())}this._events[t].push(e)}else this._events[t]=[this._events[t],e];else this._events[t]=e;return this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){var i=this;return i.on(t,function n(){i.removeListener(t,n),e.apply(this,arguments)}),this},n.prototype.removeListener=function(t,i){if("function"!=typeof i)throw Error("removeListener only takes instances of Function");if(!this._events||!this._events[t])return this;var n=this._events[t];if(s(n)){var r=e(n,i);if(0>r)return this;n.splice(r,1),0==n.length&&delete this._events[t]}else this._events[t]===i&&delete this._events[t];return this},n.prototype.removeAllListeners=function(t){return 0===arguments.length?(this._events={},this):(t&&this._events&&this._events[t]&&(this._events[t]=null),this)},n.prototype.listeners=function(t){return this._events||(this._events={}),this._events[t]||(this._events[t]=[]),s(this._events[t])||(this._events[t]=[this._events[t]]),this._events[t]}})(t("__browserify_process"))},{__browserify_process:14}],3:[function(t,e){var i=t("./class"),n=t("events").EventEmitter,s=i.extend({init:function(){},on:function(){return n.prototype.on.apply(this,arguments),this},off:function(){return n.prototype.removeListener.apply(this,arguments),this},offAll:function(){return n.prototype.removeAllListeners.apply(this,arguments),this},emit:function(){return n.prototype.emit.apply(this,arguments),this},once:function(){return n.prototype.once.apply(this,arguments),this},removeListener:function(){return n.prototype.removeListener.apply(this,arguments),this}});e.exports=s},{events:15,"./class":2}],4:[function(t,e){var i=t("./emitter"),n=i.extend({_list:null,length:null,init:function(){this._list=[],this._updateLength()},_updateLength:function(){this.length=this._list.length},add:function(t){return this._list.push(t),this._updateLength(),this},remove:function(t){return this._list.splice(this._list.indexOf(t),1),this._updateLength(),this},at:function(t){return this._list[t]},find:function(t){if("function"==typeof t)for(var e=this._list.length-1;e>=0;e--){var i=this._list[e];if(t(i))return i}},each:function(t){for(var e=0,i=this._list.length;i>e&&t(this._list[e])!==!1;e++);},list:function(){return this._list.slice()}});e.exports=n},{"./emitter":3}],5:[function(t,e){var i=t("../hiraya-core/class"),n=i.extend({value:null,max:null,name:null,init:function(){this.reset(Math.max(this.value,this.max))},setValue:function(t){return this.value=Math.max(0,t),this.value=Math.min(this.value,this.max),this},setMax:function(t){return this.max=Math.max(0,t),this},empty:function(){return this.value=0,this},add:function(t){return this.setValue(this.value+("number"==typeof t?t:1)),this},reduce:function(t){return this.setValue(this.value-("number"==typeof t?t:1)),this},reset:function(t){return"number"==typeof t&&this.setMax(t),this.value=this.max,this},isMax:function(){return this.value===this.max},isEmpty:function(){return 0===this.value}});e.exports=n},{"../hiraya-core/class":2}],6:[function(t,e){var i=t("../hiraya-core/class"),n=t("./stat"),s=i.extend({none:null,init:function(){this.set("none",0,0)},set:function(t,e,i){var s=this[t],r="number"==typeof i?i:e;return s?(s.setMax(r),s.setValue(e)):(s=n.create(),s.name=t,s.setMax(r),s.setValue(e),this[t]=s),this},get:function(t){return this[t]?this[t]:this.none}});e.exports=s},{"../hiraya-core/class":2,"./stat":5}],7:[function(t,e){var i=t("./entity"),n=i.extend({init:function(){this.parent(),this.stats.set("turn",0,100),this.stats.set("steps",1),this.stats.set("range",2),this.stats.set("turnspeed",10)}});e.exports=n},{"./entity":8}],8:[function(t,e){var i=t("../hiraya-core/getter-setter"),n=t("./stats"),s=i.extend({id:null,init:function(){void 0===this.id&&(this.id=s.id++),this.stats=n.create(),this.stats.set("health",100).set("attack",100),this.parent()},attack:function(t){return t.damage(this.stats.attack.value),this},damage:function(t){return this.stats.health.reduce(t),this},setStats:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=Stat.create({max:t[e]}))}});s.id=0,e.exports=s},{"../hiraya-core/getter-setter":16,"./stats":6}],9:[function(t,e){var i=t("../hiraya-core/emitter"),n=t("../hiraya-game/level");t("../hiraya-game/tiles");var s=i.extend({_paths:{},Level:n,start:function(){this._paths={},this._paths["levels:main"]=this.Level.create(),this.ready()},paths:function(t){return this._paths[t]},ready:function(){}});e.exports=s},{"../hiraya-core/emitter":3,"../hiraya-game/level":12,"../hiraya-game/tiles":11}],10:[function(t,e){var i=t("../hiraya-core/class"),n=i.extend({x:null,y:null,z:null,isWall:null,walls:null,cost:null,entities:null,val:function(){return this.entities.length||this.isWall?1e3:1},init:function(){this.entities=[],this.cost=-1},json:function(){return{x:this.x,y:this.y,z:this.z}},occupy:function(t){this.has(t)||(this.entities.push(t),t.set("tile",this))},has:function(t){return this.entities.indexOf(t)>-1},vacate:function(t){return this.has(t)&&(t.set("tile",null),this.entities.splice(this.entities.indexOf(t),1)),this},isOccupied:function(){return this.entities.length>0},blocked:function(t){var e,i,n=t.x,s=t.y;if(this.walls&&this.walls.length)for(var r=this.walls.length-1;r>=0;r--)if(e=this.walls[r],e[0]==n&&e[1]===s){i=!0;break}return i},nearest:function(t){for(var e=[],i=[],n=0,s=t.length;s>n;n++){for(var r=t[n],a=Math.abs(r.x+r.y-this.x-this.y),o=0,h=0,u=e.length;u>h;h++)if(e[h]>a){o=h;break}e.splice(o,0,a),i.splice(o,0,r)}return i[0]}});e.exports=n},{"../hiraya-core/class":2}],11:[function(t,e){var i=t("../hiraya-core/class"),n=t("./tile"),s=i.extend({columns:8,rows:8,_matrix:null,_total:null,Tile:n,init:function(){this._generate()},_generate:function(){this._matrix=[],this._total=0;for(var t=0;this.rows>t;t++){this._matrix.push([]);for(var e=0;this.columns>e;e++){var i=this.Tile.create();i.x=e,i.y=t,i.z=this._total,this._matrix[t].push(i),this._total++}}},get:function(t,e){var i;return(i=this._matrix[e])&&(i=i[t])?i:i},adjacent:function(t){var e,i;return i=[],(e=this.get(t.x-1,t.y-1))&&i.push(e),(e=this.get(t.x,t.y-1))&&i.push(e),(e=this.get(t.x+1,t.y-1))&&i.push(e),(e=this.get(t.x-1,t.y))&&i.push(e),(e=this.get(t.x+1,t.y))&&i.push(e),(e=this.get(t.x-1,t.y+1))&&i.push(e),(e=this.get(t.x,t.y+1))&&i.push(e),(e=this.get(t.x+1,t.y+1))&&i.push(e),i},_movementCost:function(t,e){return e.wall?1e4:e.val()},range:function(t,e,i){var n,s,r,a,o,h,u,l=[t],c=[];for(void 0===e&&(e=1);l.length>0;)if(n=l.pop(),c.push(n),e>n.cost)for(s=this.adjacent(n),h=s.length,o=0;h>o;o++)r=s[o],u=i?1:this._movementCost(n,r),a=n.cost+u,r.blocked(n)||n.blocked(r)||(-1===r.cost||r.cost>a)&&(r.cost=a,-1===l.indexOf(r)&&l.push(r));var f=[];for(o=0,h=c.length;h>o;o++)n=c[o],e>n.cost&&-1===f.indexOf(n)&&f.push(n),n.cost=-1;return f},path:function(t,e){var i,n,s,r,a,o,h,u,l;for(i=[t],n=[];i.length;){var c=0;for(u=0,l=i.length;l>u;u++)i[u].f<i[c].f&&(c=u);if(s=i[c],s.x===e.x&&s.y===e.y){for(var f,p=s,y=[];p.parent;)y.push(p),f=p.parent,p.parent=null,p=f;return y.reverse()}for(i.splice(s,1),n.push(s),r=this.adjacent(s),u=0,l=r.length;l>u;u++)a=r[u],n.indexOf(a)>-1||a.wall||s.blocked(a)||a.blocked(s)||(o=s.g+1,h=!1,-1===i.indexOf(a)?(h=!0,a.h=this.heuristic(a,e),i.push(a)):a.g>o&&(h=!0),h&&(a.parent=s,a.g=o,a.f=a.g+a.h))}return[]},heuristic:function(t,e,i){var n,s;return null===i&&(i=1),n=Math.pow(t.x-e.x,2),s=Math.pow(t.y-e.y,2),Math.sqrt(n+s)}});e.exports=s},{"../hiraya-core/class":2,"./tile":10}],12:[function(t,e){var i=t("../hiraya-core/getter-setter"),n=t("../hiraya-core/collection"),s=t("./entity"),r=t("./tiles"),a=i.extend({entities:null,Entity:s,_entityIDs:{},Tiles:r,init:function(){this.tiles=this.Tiles.create(),this.entities=n.create(),this.parent(),this.ready()},ready:function(){this.emit("ready")},addEntity:function(t){return this.entities.add(t),this.addedEntity(t),t.id&&(this._entityIDs[t.id]=t),this},removeEntity:function(t){return t&&(this.entities.remove(t),this._entityIDs[t.id]===t&&delete this._entityIDs[t.id]),this},getEntity:function(t){return this._entityIDs[t]},createEntity:function(t){var e=JSON.parse(JSON.stringify(t)),i=t.stats,n=t.tile;delete e.stats,delete e.tile;var s=this.Entity.create(e);if(t){if(i)for(var r in i)if(i.hasOwnProperty(r)){var a=i[r];s.stats.set(r,a[0],a[1])}if(n){var o=this.tiles.get(n.x,n.y);o&&o.occupy(s)}}return s},addedEntity:function(){}});e.exports=a},{"../hiraya-core/getter-setter":16,"../hiraya-core/collection":4,"./entity":8,"./tiles":11}],13:[function(t,e){var i=t("./level"),n=t("./entity-turnbased"),s=i.extend({Entity:n,tickSpeed:1,_maxGetTurnAttempts:25,getTurn:function(){var t,e=this,i=0,n=this._maxGetTurnAttempts,s=function(){t=e._getEntityTurn(),i++,t?(t.stats.turn.empty(),e.gotTurn(t)):n>i?setTimeout(s,e.tickSpeed):e.getTurnTimedOut()};s()},_getEntityTurn:function(){for(var t,e,i=this.entities.length,n=0;i>n;n++)if(t=this.entities.at(n),t.stats.turn.add(t.stats.turnspeed.value),t.stats.turn.isMax()){e=t;break}return e},evaluateEntities:function(){var t=[],e=[];this.entities.each(function(i){i.stats.health.isEmpty()?e.push(i):t.push(i)}),1>=t.length?this.hasWinner(t[0]):this.hasNoWinnerYet()},proximity:function(t,e){var i,n=[],s=[],r=Math.floor(.5*this.tiles.columns);"range"===e&&(r=t.stats.range.value),i=this.tiles.range(t.tile,r,!0);for(var a=0,o=i.length;o>a;a++){var h=i[a],u=h.entities[0];if(u&&u!==t){if(u.stats.health.isEmpty())continue;for(var l=Math.abs(u.tile.x-t.tile.x+u.tile.y-t.tile.y),c=0,f=0,p=n.length;p>f;f++)if(n[f]>l){c=f;break}n.splice(c,0,l),s.splice(c,0,u)}}return s},nearestEntityTileFrom:function(t){var e,i=this.proximity(t),n=i[0];return n&&(e=t.tile.nearest(this.tiles.adjacent(n.tile))),e},gotTurn:function(){},hasWinner:function(){},hasNoWinnerYet:function(){},getTurnTimedOut:function(){}});e.exports=s},{"./level":12,"./entity-turnbased":7}],16:[function(t,e){var i=t("./emitter"),n=i.extend({set:function(t,e){return this[t]=e,this.emit(t,e),this},get:function(t){return this.hasOwnProperty(t)?this[t]:null}});e.exports=n},{"./emitter":3}]},{},[1]);